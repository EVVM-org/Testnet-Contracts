# EVVM Testnet Contracts

![](https://github.com/user-attachments/assets/08d995ee-7512-42e4-a26c-0d62d2e8e0bf)

The Ethereum Virtual Virtual Machine (EVVM) ⚙️

**This repository is the next step after successful playground testing. It is dedicated to advanced integration, deployment, and validation on public testnets, before mainnet implementation.**

EVVM provides a comprehensive set of smart contracts and tools for scalable, modular, and cross-chain EVM virtualization. This repo is intended for developers who want to:
- Test and validate contracts on public testnets (Ethereum Sepolia, Arbitrum Sepolia)
- Prepare for mainnet deployment after testnet validation
- Contribute to the evolution of the EVVM protocol

## Repository Structure
- `src/contracts/evvm/` — Core EVVM contracts and storage
- `src/contracts/nameService/` — NameService contracts for domain management
- `src/contracts/staking/` — Staking and Estimator contracts
- `src/contracts/treasury/` — Treasury contract for managing deposits and withdrawals
- `src/lib/` — Shared Solidity libraries (AdvancedStrings, SignatureRecover, etc.)
- `script/` — Deployment and automation scripts (e.g., `DeployTestnet.s.sol`)
- `lib/` — External dependencies (OpenZeppelin, Uniswap v3, forge-std)
- `broadcast/` — Foundry deployment artifacts and transaction history
- `cache/` — Foundry compilation cache
- `input/` — Configuration files for deployment (generated by `evvm-init.sh`)
- `evvm-init.sh` — Interactive setup and deployment script

## Public EVVM Contract Address

### Ethereum Sepolia Testnet
- **EVVM**: [0x2029bb5e15E22c19Bc8bde3426fab29dD4db8A98](https://sepolia.etherscan.io/address/0x2029bb5e15E22c19Bc8bde3426fab29dD4db8A98#code)
- **NameService**: [0xD904f38B8c9968AbAb63f47c21aB120FCe59F013](https://sepolia.etherscan.io/address/0xD904f38B8c9968AbAb63f47c21aB120FCe59F013#code)
- **Staking**: [0xA68D4a0cFFDc6145D35Ae27521d01b166Fe4AE46](https://sepolia.etherscan.io/address/0xA68D4a0cFFDc6145D35Ae27521d01b166Fe4AE46#code)
- **Estimator**: [0x2aBEAD7519c9AFc14eEc2582dDD9FF04f0da0F42](https://sepolia.etherscan.io/address/0x2aBEAD7519c9AFc14eEc2582dDD9FF04f0da0F42#code)
- **Treasury**: [0x98465F828b82d0b676937e159547F35BBDBdfe91](https://sepolia.etherscan.io/address/0x98465F828b82d0b676937e159547F35BBDBdfe91#code)

### Arbitrum Sepolia Testnet
- **EVVM**: [0xC688C12541Ff85EF3E63755F6889317f312d03A3](https://sepolia.arbiscan.io/address/0xC688C12541Ff85EF3E63755F6889317f312d03A3#code)
- **NameService**: [0x82Fbac7857E8407cE6578E02B0be0d3Cd15Fb790](https://sepolia.arbiscan.io/address/0x82Fbac7857E8407cE6578E02B0be0d3Cd15Fb790#code)
- **Staking**: [0xaC3C70604a5633807Ae0149B6E6766452355635C](https://sepolia.arbiscan.io/address/0xaC3C70604a5633807Ae0149B6E6766452355635C#code)
- **Estimator**: [0xC4FF60fBAEf050FC476f4Ab10CA75378A2Cc79A3](https://sepolia.arbiscan.io/address/0xC4FF60fBAEf050FC476f4Ab10CA75378A2Cc79A3#code)
- **Treasury**: [0x7d4F9D95e84f6903c7247527e6BF1FA864F7c764](https://sepolia.arbiscan.io/address/0x7d4F9D95e84f6903c7247527e6BF1FA864F7c764#code)

## Development Flow
1. **Playground**: Prototype and experiment with new features in the playground repo.
2. **Testnet (this repo)**: Integrate, test, and validate on public testnets.
3. **Mainnet**: After successful testnet validation, proceed to mainnet deployment.

## Prerequisites
- [Foundry](https://getfoundry.sh/) (Solidity development toolkit)
- Node.js (for dependency management)
- Bash shell (for running `evvm-init.sh`)
- Environment variables set up (`.env` file with API keys and RPC URLs)

### Environment Setup
Create a `.env` file with your configuration:
```bash
RPC_URL_ETH_SEPOLIA=<YOUR_ETH_SEPOLIA_RPC_URL>
RPC_URL_ARB_SEPOLIA=<YOUR_ARB_SEPOLIA_RPC_URL>
ETHERSCAN_API=<YOUR_ETHERSCAN_API_KEY>
```

### Security Setup - Import Private Key
Before deploying to testnets, securely import your private key using Foundry:
```bash
cast wallet import defaultKey --interactive
```
This command will prompt you to enter your private key securely. The key will be encrypted and stored locally by Foundry.

> **Note**: `defaultKey` is the default alias used in the makefile and deployment scripts. If you prefer to use a different alias, simply replace `defaultKey` with your chosen name in both the import command and update the corresponding references in the makefile and scripts.

> **Security Note**: Never commit real private keys to version control. Always use the secure wallet import method above for testnet and mainnet deployments.

## Key Dependencies
- [OpenZeppelin Contracts](https://github.com/OpenZeppelin/openzeppelin-contracts)

## Quick Start

Deploy your EVVM virtual blockchain on testnet in 4 simple steps:

### 1. Clone and Install
```bash
git clone https://github.com/EVVM-org/Testnet-Contracts
cd Testnet-Contracts
make install
```

### 2. Environment Setup
Create `.env` file with your configuration:
```bash
cp .env.example .env
# Add your RPC URLs and API keys
```

### 3. Secure Key Import
```bash
cast wallet import defaultKey --interactive
```

### 4. Interactive Setup & Deploy
```bash
./evvm-init.sh
```

The wizard will configure:
- **Administrator addresses** (admin, golden fisher, activator)
- **EVVM metadata** (name, ID, principal token details)
- **Advanced parameters** (supply, rewards) - optional
- **Network selection** (Ethereum Sepolia, Arbitrum Sepolia, or custom)
- **Automatic deployment** with contract verification

That's it! Your EVVM virtual blockchain is now deployed and verified on your chosen host blockchain.

## Manual Configuration (Alternative)

If you prefer manual control over configuration, create these files in `input/`:

**input/address.json**:
```json
{
  "admin": "0x...",
  "goldenFisher": "0x...",
  "activator": "0x..."
}
```

**input/evvmBasicMetadata.json**:
```json
{
  "EvvmName": "EVVM",
  "EvvmID": 1,
  "principalTokenName": "Mate token",
  "principalTokenSymbol": "MATE"
}
```

**input/evvmAdvancedMetadata.json**:
```json
{
  "totalSupply": 2033333333000000000000000000,
  "eraTokens": 1016666666500000000000000000,
  "reward": 5000000000000000000
}
```

## Local Development
Start a local Anvil chain:
```bash
make anvil
```

Deploy contracts to local testnet:
```bash
make deployLocalTestnet
```

## Manual Deployment

If you prefer to deploy manually after configuration:

```bash
# Ethereum Sepolia
make deployTestnet NETWORK=eth

# Arbitrum Sepolia  
make deployTestnet NETWORK=arb

# Custom RPC
forge script script/DeployTestnet.s.sol:DeployTestnet \
    --rpc-url <YOUR_RPC_URL> \
    --account defaultKey \
    --broadcast \
    --verify \
    --etherscan-api-key $ETHERSCAN_API
```

## Local Development
```bash
make anvil                # Start local blockchain
make deployLocalTestnet   # Deploy to local chain
```

## Development Commands
```bash
make install     # Install dependencies and compile
make compile     # Recompile contracts
make seeSizes    # Check contract sizes
make help        # Show all available commands
```

## Contract Architecture
The EVVM ecosystem consists of five main contracts:
- **Evvm.sol**: Core virtual machine implementation
- **NameService.sol**: Domain name resolution system  
- **Staking.sol**: Token staking and rewards mechanism
- **Estimator.sol**: Staking rewards estimation and calculation
- **Treasury.sol**: Manages deposits and withdrawals of ETH and ERC20 tokens
- **Treasury.sol**: Manages deposits and withdrawals of ETH and ERC20 tokens

## Configuration Files
Key files for EVVM deployment:
- `evvm-init.sh` — Interactive setup wizard
- `input/` — Generated configuration files (address.json, evvmBasicMetadata.json, evvmAdvancedMetadata.json)
- `foundry.toml` — Foundry project configuration
- `makefile` — Build and deployment automation

## Contributing
1. Fork the repository
2. Create a feature branch and make changes
3. Add tests for new features
4. Submit a PR with a detailed description

## Security Best Practices
- **Never commit private keys**: Always use `cast wallet import <YOUR_ALIAS> --interactive` to securely store your keys
- **Use test credentials only**: This repository is for testnet deployment only
- **Environment variables**: Store sensitive data like API keys in `.env` files (not committed to git)
- **Verify contracts**: Always verify your deployed contracts on block explorers
