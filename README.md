# EVVM Testnet Contracts

![](https://github.com/user-attachments/assets/08d995ee-7512-42e4-a26c-0d62d2e8e0bf)

The Ethereum Virtual Virtual Machine (EVVM) ⚙️

**This repository is the next step after successful playground testing. It is dedicated to advanced integration, deployment, and validation on public testnets, before mainnet implementation.**

EVVM provides a comprehensive set of smart contracts and tools for scalable, modular, and cross-chain EVM virtualization. This repo is intended for developers who want to:
- Test and validate contracts on public testnets (Ethereum Sepolia, Arbitrum Sepolia)
- Prepare for mainnet deployment after testnet validation
- Contribute to the evolution of the EVVM protocol

## Repository Structure
- `src/contracts/evvm/` — Core EVVM contracts and storage
- `src/contracts/nameService/` — NameService contracts for domain management
- `src/contracts/staking/` — Staking and Estimator contracts
- `src/contracts/treasury/` — Treasury contract for managing deposits and withdrawals
- `src/lib/` — Shared Solidity libraries (AdvancedStrings, SignatureRecover, etc.)
- `script/` — Deployment and automation scripts (e.g., `DeployTestnet.s.sol`)
- `lib/` — External dependencies (OpenZeppelin, Uniswap v3, forge-std)
- `broadcast/` — Foundry deployment artifacts and transaction history
- `cache/` — Foundry compilation cache
- `input/` — Configuration files for deployment (generated by `evvm-init.sh`)
- `evvm-init.sh` — Interactive setup and deployment script

## Public EVVM Contract Address

### Ethereum Sepolia Testnet
- **EVVM**: [0x2029bb5e15E22c19Bc8bde3426fab29dD4db8A98](https://sepolia.etherscan.io/address/0x2029bb5e15E22c19Bc8bde3426fab29dD4db8A98#code)
- **NameService**: [0xD904f38B8c9968AbAb63f47c21aB120FCe59F013](https://sepolia.etherscan.io/address/0xD904f38B8c9968AbAb63f47c21aB120FCe59F013#code)
- **Staking**: [0xA68D4a0cFFDc6145D35Ae27521d01b166Fe4AE46](https://sepolia.etherscan.io/address/0xA68D4a0cFFDc6145D35Ae27521d01b166Fe4AE46#code)
- **Estimator**: [0x2aBEAD7519c9AFc14eEc2582dDD9FF04f0da0F42](https://sepolia.etherscan.io/address/0x2aBEAD7519c9AFc14eEc2582dDD9FF04f0da0F42#code)
- **Treasury**: [0x98465F828b82d0b676937e159547F35BBDBdfe91](https://sepolia.etherscan.io/address/0x98465F828b82d0b676937e159547F35BBDBdfe91#code)

### Arbitrum Sepolia Testnet
- **EVVM**: [0xC688C12541Ff85EF3E63755F6889317f312d03A3](https://sepolia.arbiscan.io/address/0xC688C12541Ff85EF3E63755F6889317f312d03A3#code)
- **NameService**: [0x82Fbac7857E8407cE6578E02B0be0d3Cd15Fb790](https://sepolia.arbiscan.io/address/0x82Fbac7857E8407cE6578E02B0be0d3Cd15Fb790#code)
- **Staking**: [0xaC3C70604a5633807Ae0149B6E6766452355635C](https://sepolia.arbiscan.io/address/0xaC3C70604a5633807Ae0149B6E6766452355635C#code)
- **Estimator**: [0xC4FF60fBAEf050FC476f4Ab10CA75378A2Cc79A3](https://sepolia.arbiscan.io/address/0xC4FF60fBAEf050FC476f4Ab10CA75378A2Cc79A3#code)
- **Treasury**: [0x7d4F9D95e84f6903c7247527e6BF1FA864F7c764](https://sepolia.arbiscan.io/address/0x7d4F9D95e84f6903c7247527e6BF1FA864F7c764#code)

## Development Flow
1. **Playground**: Prototype and experiment with new features in the playground repo.
2. **Testnet (this repo)**: Integrate, test, and validate on public testnets.
3. **Mainnet**: After successful testnet validation, proceed to mainnet deployment.

## Prerequisites
- [Foundry](https://getfoundry.sh/) (Solidity development toolkit)
- Node.js (for dependency management)
- Bash shell (for running `evvm-init.sh`)
- Environment variables set up (`.env` file with API keys and RPC URLs)

### Environment Setup
Create a `.env` file with your configuration:
```bash
RPC_URL_ETH_SEPOLIA=<YOUR_ETH_SEPOLIA_RPC_URL>
RPC_URL_ARB_SEPOLIA=<YOUR_ARB_SEPOLIA_RPC_URL>
ETHERSCAN_API=<YOUR_ETHERSCAN_API_KEY>
```

### Security Setup - Import Private Key
Before deploying to testnets, securely import your private key using Foundry:
```bash
cast wallet import defaultKey --interactive
```
This command will prompt you to enter your private key securely. The key will be encrypted and stored locally by Foundry.

> **Note**: `defaultKey` is the default alias used in the makefile and deployment scripts. If you prefer to use a different alias, simply replace `defaultKey` with your chosen name in both the import command and update the corresponding references in the makefile and scripts.

> **Security Note**: Never commit real private keys to version control. Always use the secure wallet import method above for testnet and mainnet deployments.

## Key Dependencies
- [OpenZeppelin Contracts](https://github.com/OpenZeppelin/openzeppelin-contracts)

## Quick Start
```bash
git clone https://github.com/EVVM-org/Testnet-Contracts
cd Testnet-Contracts
make install
```

### Security Setup
Import your private key securely before deploying:
```bash
cast wallet import defaultKey --interactive
```

> **Note**: You can use any alias instead of `defaultKey`. If you choose a different alias, make sure to update the `makefile` and `evvm-init.sh` accordingly.

### Automated Setup with evvm-init.sh
For a guided setup and deployment process, use the initialization script:
```bash
./evvm-init.sh
```

This interactive script will:
- Guide you through configuring administrator addresses
- Set up EVVM metadata (name, ID, token details)
- Generate required configuration files in the `input/` directory
- Optionally deploy contracts to your chosen network

## Installation
Install dependencies and compile contracts:
```bash
make install
```

### Configuration Setup
Before deploying, you need to configure the deployment parameters. You can do this in two ways:

#### Option 1: Automated Setup (Recommended)
Run the interactive setup script:
```bash
./evvm-init.sh
```
This will create the necessary configuration files:
- `input/address.json` - Administrator addresses
- `input/evvmBasicMetadata.json` - EVVM name, ID, and token details
- `input/evvmAdvancedMetadata.json` - Supply and reward parameters

#### Option 2: Manual Configuration
Manually create the required JSON files in the `input/` directory:

**input/address.json**:
```json
{
  "admin": "0x...",
  "goldenFisher": "0x...",
  "activator": "0x..."
}
```

**input/evvmBasicMetadata.json**:
```json
{
  "EvvmName": "EVVM",
  "EvvmID": 1,
  "principalTokenName": "Mate token",
  "principalTokenSymbol": "MATE"
}
```

**input/evvmAdvancedMetadata.json**:
```json
{
  "totalSupply": 2033333333000000000000000000,
  "eraTokens": 1016666666500000000000000000,
  "reward": 5000000000000000000
}
```

## Local Development
Start a local Anvil chain:
```bash
make anvil
```

Deploy contracts to local testnet:
```bash
make deployLocalTestnet
```

## Deployment
**Important**: Before deploying, ensure you have imported your private key securely:
```bash
cast wallet import defaultKey --interactive
```

> **Tip**: If you use a different alias instead of `defaultKey`, update the `--account` parameter in the deployment commands accordingly.

Deploy contracts to Ethereum Sepolia testnet:
```bash
make deployTestnet NETWORK=eth
```
Deploy contracts to Arbitrum Sepolia testnet:
```bash
make deployTestnet NETWORK=arb
```

### Custom Network Deployment
For custom RPC endpoints, use Forge directly:
```bash
forge script script/DeployTestnet.s.sol:DeployTestnet \
    --rpc-url <YOUR_RPC_URL> \
    --account defaultKey \
    --broadcast \
    --verify \
    --etherscan-api-key $ETHERSCAN_API \
    -vvvvvv
```

> **Note**: Replace `defaultKey` with your chosen alias if you used a different name when importing your wallet.

> **Note**: Ensure you have configured the deployment parameters using `./evvm-init.sh` or manually created the configuration files before deploying.

## Compilation and Testing
Recompile contracts:
```bash
make compile
```
Check contract sizes:
```bash
make seeSizes
```

## Available Commands
Get help with all available commands:
```bash
make help
```

## Configuration Files
- `foundry.toml` — Foundry project configuration with remappings
- `package.json` — Node.js dependencies for cross-chain protocols
- `makefile` — Build and deployment automation
- `wake.toml` — Wake tooling configuration
- `evvm-init.sh` — Interactive setup wizard for deployment configuration
- `input/` — Directory containing deployment configuration files:
  - `address.json` — Administrator and key addresses
  - `evvmBasicMetadata.json` — EVVM name, ID, and token metadata
  - `evvmAdvancedMetadata.json` — Supply and reward parameters

## Contract Architecture
The EVVM ecosystem consists of four main contracts:
- **Evvm.sol**: Core virtual machine implementation
- **NameService.sol**: Domain name resolution system  
- **Staking.sol**: Token staking and rewards mechanism
- **Estimator.sol**: Staking rewards estimation and calculation
- **Treasury.sol**: Manages deposits and withdrawals of ETH and ERC20 tokens, ensuring secure integration with the EVVM ecosystem.

## Contributing
1. Fork the repository
2. Create a feature branch and make changes
3. Add tests for new features
4. Submit a PR with a detailed description

## Security Best Practices
- **Never commit private keys**: Always use `cast wallet import <YOUR_ALIAS> --interactive` to securely store your keys
- **Use test credentials only**: This repository is for testnet deployment only
- **Environment variables**: Store sensitive data like API keys in `.env` files (not committed to git)
- **Verify contracts**: Always verify your deployed contracts on block explorers
